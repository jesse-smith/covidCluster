completed %>%
create_table(sex) %>%
create_pie(
title = "Gender",
palette = "blue"
)
# Gender
completed %>%
create_table(sex)
create_pie(
title = "Gender",
palette = "blue"
)
# Gender
completed %>%
create_table(sex) %>%
create_pie(
title = "Gender",
palette = "blue"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_pie(
title = "Gender",
palette = "blue"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_pie(
title = "Gender",
palette = "blue"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_pie(
title = "Gender",
palette = "blue"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_pie(
title = "Gender",
palette = "blue"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_pie(
title = "Gender",
palette = "blue"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_pie(
title = "Gender",
palette = "blue"
)
# Gender
completed %>%
create_table(sex) %>%
create_pie(
title = "Gender",
palette = "blue",
)
# Gender
completed %>%
create_table(sex) %>%
create_pie(
title = "Gender",
palette = "blue", include_missing = TRUE
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_pie(
title = "Gender",
palette = "blue", include_missing = TRUE
)
# Gender
completed %>%
create_table(sex) %>%
create_pie(
title = "Gender",
palette = "blue"
)
devtools::load_all(".")
library(covidCluster)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue"
)
data <- load_integrated_data(date = Sys.Date() - 1) %>% preprocess()
library(covidCluster)
devtools::load_all(".")
data <- load_integrated_data(date = Sys.Date() - 1) %>% preprocess()
library(tidyverse)
library(coviData)
library(covidCluster)
data <- load_integrated_data(date = Sys.Date() - 1) %>% preprocess()
data <- load_integrated_data(date = Sys.Date() - 2) %>% preprocess()
# Filter to completed records based on age heuristic
data %>%
filter(!is.na(age)) ->
completed
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue"
)
# Gender
completed %>%
create_table(sex)
# Gender
completed %>%
create_table(sex) %>%
create_pie(
title = "Gender",
palette = "blue"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_pie(
title = "Gender",
palette = "blue"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue"
)
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue",
)
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue", bg = "#f0f0f0"
)
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue", bg = "gray94"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue", bg = "gray94"
)
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue", background = "gray94"
)
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue", background = "red"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue", background = "red"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue", background = "red"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue", background = "red"
)
devtools::load_all(".")
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue", background = "red"
)
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue", background = "white"
)
# Gender
completed %>%
create_table(sex) %>%
create_bar(
title = "Gender",
palette = "blue", background = "gray93"
)
# Load data into R
download_integrated_data()
data <- load_integrated_data() %>% preprocess()
# Filter to completed records based on age heuristic
data %>%
filter(!is.na(age)) ->
completed
# Gender
completed %>%
create_table(sex) ->
sex
#Race
completed %>%
mutate(
race = race %>%
forcats::fct_lump_prop(prop = 0.2, other_level = "Other Race")
) %>%
create_table(race) ->
race
completed %>%
create_table(ethnicity) ->
ethnicity
completed %>%
create_table(marrital) ->
marital
completed %>%
create_table(asymp) ->
asymp
# Count those who are students
completed %>%
create_table(student) ->
student
# Age
completed %>%
mutate(
age = age %>%
fct_cut(breaks = c(0, 5, 18, 25, 35, 45, 55, 65, 75, 85, Inf))
) %>%
create_table(age, infreq = FALSE) ->
age
# Count students who attend different school types
completed %>%
filter(student == "Yes") %>%
create_table(school_type) ->
school_type
# Count students who are in various schools
completed %>%
filter(student == "Yes") %>%
mutate(school_name = standardize_string(school_name)) %>%
create_table(school_name) ->
school_name
# Count students activity participation
completed %>%
filter(student == "Yes") %>%
create_table(school_activity) ->
school_activity
# Count types of activity
completed %>%
filter(student == "Yes", school_activity_mode != "Virtual") %>%
select(-starts_with("school_activity_type_2_")) %>%
pivot_table(starts_with("school_activity_type_"))
school_activity_type
# Count types of activity
completed %>%
filter(student == "Yes", school_activity_mode != "Virtual") %>%
select(-starts_with("school_activity_type_2_")) %>%
pivot_table(starts_with("school_activity_type_")) ->
school_activity_type
# Count whether employed
completed$employment %>%
create_table(employment) ->
employment
# Count whether employed
completed %>%
create_table(employment) ->
employment
# Count occupations among employed
completed %>%
filter(employment != "Unemployed") %>%
pivot_table(starts_with("occupation_"), name = "occupation") ->
occupation
# Count occupations among employed
completed %>%
filter(employment != "Unemployed") %>%
pivot_table(starts_with("occupation_")) ->
occupation
# Count other occupations
completed %>%
filter(employment != "Unemployed",!is.na(occupation_8)) %>%
pivot_table(starts_with("occuother_")) ->
occuother
# Count other other occupations
completed %>%
filter(
employment != "Unemployed",
!is.na(occupation_8),
!is.na(occuother_8)
) %>%
create_table(occupationotherother_2) ->
occupationotherother_2
# Count healthcare occupations
completed %>%
filter(!is.na(occupation_1)) %>%
select(-starts_with("occuhealth_2_")) %>%
pivot_table(starts_with("occuhealth_")) ->
occuhealth
# Count other healthcare settings
completed %>%
filter(
!is.na(occupation_1),
!is.na(occuhealth_7)
) %>%
create_table(occupationhealthother) %>%
mutate(
occupationhealthother = occupationhealthother %>%
forcats::fct_recode(Missing = "unknown")
) ->
occupationhealthother
# Count other healthcare settings
completed %>%
filter(
!is.na(occupation_1),
!is.na(occuhealth_7)
) %>%
create_table(occupationhealthother) %>%
mutate(
occupationhealthother = occupationhealthother
) ->
occupationhealthother
# Count health professions
completed %>%
filter(!is.na(occupation_1)) %>%
pivot_table(starts_with("occuhealth_2_")) ->
occuhealth_2
# Count other health professions
completed %>%
filter(
!is.na(occupation_1),
!is.na(occuhealth_2_11)
) %>%
create_table(occupationhealthjobother) ->
occupationhealthjobother
# Count types of activities during exposure period
completed %>%
select(-starts_with("cont_exp_t"), -starts_with("cont_exp_2_")) %>%
pivot_table(starts_with("cont_exp_")) ->
cont_exp
# Count other exposure activities
completed %>%
filter(!is.na(cont_exp_18)) %>%
pivot_table(starts_with("cont_exp_2_")) ->
cont_exp_2
# Count event names
completed %>%
filter(is.na(cont_exp_19)) %>%
pivot_table(
cont_exp_t2,
cont_exp_t13,
cont_exp_t14,
cont_exp_t15
) ->
cont_exp_t
# Count exposure settings
completed %>%
pivot_table(starts_with("exposuresetting_")) ->
exposuresetting
# Count social gathering exposures
completed %>%
pivot_table(starts_with("exposuresocial_")) ->
exposuresocial
# Count other social gathering exposures
completed %>%
filter(!is.na(exposuresocial_25)) %>%
create_table(exposuresocialother) ->
exposuresocialother
dataset_list <- list(
student = student,
school_type = school_type,
school_name = school_name,
school_activity = school_activity,
school_activity_type = school_activity_type,
employment = employment,
occupation = occupation,
occuother = occuother,
occupationotherother_2 = occupationotherother_2,
occuhealth = occuhealth,
occupationhealthother = occupationhealthother,
occuhealth_2 = occuhealth_2,
occupationhealthjobother = occupationhealthjobother,
cont_exp = cont_exp,
cont_exp_2 = cont_exp_2,
cont_exp_t = cont_exp_t,
exposuresetting = exposuresetting,
exposuresettinghealth = exposuresettinghealth,
exposuresocial = exposuresocial,
exposuresocialother = exposuresocialother,
asymp = asymp,
ethnicity = ethnicity,
marital = marital,
race = race,
sex = sex,
age = age
)
# Count healthcare exposures
completed %>%
filter(!is.na(exposuresetting_5)) %>%
create_table(exposuresettinghealth) ->
exposuresettinghealth
dataset_list <- list(
student = student,
school_type = school_type,
school_name = school_name,
school_activity = school_activity,
school_activity_type = school_activity_type,
employment = employment,
occupation = occupation,
occuother = occuother,
occupationotherother_2 = occupationotherother_2,
occuhealth = occuhealth,
occupationhealthother = occupationhealthother,
occuhealth_2 = occuhealth_2,
occupationhealthjobother = occupationhealthjobother,
cont_exp = cont_exp,
cont_exp_2 = cont_exp_2,
cont_exp_t = cont_exp_t,
exposuresetting = exposuresetting,
exposuresettinghealth = exposuresettinghealth,
exposuresocial = exposuresocial,
exposuresocialother = exposuresocialother,
asymp = asymp,
ethnicity = ethnicity,
marital = marital,
race = race,
sex = sex,
age = age
)
wb <- openxlsx::createWorkbook()
for (i in seq_along(dataset_list)) {
page <- dataset_list %>% names() %>% .[[i]]
openxlsx::addWorksheet(wb, sheetName = page)
openxlsx::writeData(wb, sheet = page, x = dataset_list[[i]])
}
openxlsx::saveWorkbook(
wb,
file = "V:/EPI DATA ANALYTICS TEAM/Cluster Analysis/frequencies_2020-10-30.xlsx"
)
